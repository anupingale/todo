<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  <script src="main.js"></script>
</head>

<body>
  hello
  <div id="content"></div>

  <form method="POST" action="/addTodo">
    <input type="text" name="title">
    <input type="text" name="description">
    <input type="text" name="task_detail">
    <input type="submit">
  </form>

  <div>
    Add a new todo
    <input type="text" id="todo_title">
    <input type="text" id="todo_description">
    <input type="submit" onclick="addTodo()">
  </div>

  <div>
    Edit a new todo
    <input type="text" id="todo_edit_id">
    <input type="text" id="todo_edit_title">
    <input type="text" id="todo_edit_description">
    <input type="submit" onclick="editTodo()">
  </div>

  <div>
    Delete a todo
    <input type="text" id="todo_delete_id">
    <input type="submit" onclick="deleteTodo()">
  </div>

  <div>
    Add a task
    <input type="text" id="todo_id_addTask">
    <input type="text" id="task_description">
    <input type="submit" onclick="addTodoTask()">
  </div>

  <div>
    Edit a task
    <input type="text" id="todo_id_editTask">
    <input type="text" id="task_edit_id">
    <input type="text" id="task_edit_description">
    <input type="submit" onclick="editTodoTask()">
  </div>

  <div>
    Delete a task
    <input type="text" id="todo_id_deleteTask">
    <input type="text" id="task_delete_id">
    <input type="submit" onclick="deleteTodoTask()">
  </div>
</body>
<script>

  const deleteTodoTask = function () {
    const todoId = document.getElementById("todo_id_deleteTask").value;
    const taskId = document.getElementById("task_delete_id").value;
    fetch("/deleteTodoTask", { method: "POST", body: JSON.stringify({ todoId, taskId }) });
    loadTodo();
  }

  const editTodoTask = function () {
    const taskDescription = document.getElementById("task_edit_description").value;
    const taskId = document.getElementById("task_edit_id").value;
    const todoId = document.getElementById("todo_id_editTask").value;
    fetch("/editTodoTask", { method: "POST", body: JSON.stringify({ todoId, taskId, taskDescription }) });
    loadTodo();
  }

  const addTodoTask = function () {
    const todoId = document.getElementById("todo_id_addTask").value;
    const taskDescription = document.getElementById("task_description").value;
    fetch("/addTodoTask", { method: "POST", body: JSON.stringify({ todoId, taskDescription }) });
    loadTodo();
  }

  const deleteTodo = function () {
    const id = document.getElementById("todo_delete_id").value;
    fetch("/deleteUserTodo", { method: "POST", body: JSON.stringify({ id }) });
    loadTodo();
  }

  const addTodo = function () {
    const title = document.getElementById("todo_title").value;
    const description = document.getElementById("todo_description").value;
    fetch("/addUserTodo", { method: "POST", body: JSON.stringify({ title, description }) });
    loadTodo();
  }

  const editTodo = function () {
    const title = document.getElementById("todo_edit_title").value;
    const id = document.getElementById("todo_edit_id").value;
    const description = document.getElementById("todo_edit_description").value;
    fetch("/editUserTodo", { method: "POST", body: JSON.stringify({ id, title, description }) });
    loadTodo();
  }

  let result;
  const loadTodo = function () {
    document.getElementById("content").innerHTML = '';
    fetch('/loadTodoList').then(res => res.json())
      .then(text => {
        Object.keys(text).forEach(t => {
          let todo = document.createElement('ul');
          let para = document.createElement('p');
          para.innerHTML = t + text[t].title + ':' + text[t].description;
          todo.appendChild(para);
          Object.keys(text[t].tasks).forEach(task => {
            let task1 = document.createElement('li');
            task1.innerHTML = task + text[t].tasks[task].description + '::' + text[t].tasks[task].status;
            todo.appendChild(task1);
          })
          document.getElementById("content").appendChild(todo);
        })
      })
  }
  window.onload = () => { loadTodo() };
</script>

</html>